@*@model SVG_Restaurants.Models.Reservation*@
@model SVG_Restaurants.ViewModels.RestaurantReservationVM

@{
    ViewData["Title"] = "Create";

}

@{
    string cID = Context.Request.Query["CustomerID"];
    string rID = Context.Request.Query["RestaurantID"];
    string gID = Context.Request.Query["GuestID"];

}

@if (Convert.ToString(rID) == "1")
{
    <style type="text/css">
        body {
            background-color: #fcfcfc;
        }
    </style>
}
else if (Convert.ToString(rID) == "2")
{
    <style type="text/css">
        body {
            background-color: #fff8dc;
        }
    </style>
}
else if (Convert.ToString(rID) == "3")
{
    <style type="text/css">
        body {
            background-color: #dae1e6;
        }
    </style>
}
<div class="text-center">
    <h1 class="text-2xl font-bold md:text-4xl md:leading-tight dark:text-white">
        Reservation
    </h1>
</div>

<hr />
<div class="row">
    <div class="col-md-3">

    </div>
    <div class="col-md-6">
        <form asp-action="Create" method="post">
            @if (string.IsNullOrEmpty(cID))
            {
                <p class="text-center mt-6 text-xl leading-8 text-gray-700"><i>As a Guest</i></p>
                string guestID = Context.Request.Query["GuestID"];
                string restaurantID = Context.Request.Query["restaurantID"];
                <input type="hidden" asp-for="@Model.TheReservation.GuestId" value=@guestID />

                <div class="form-group">
                    <input type="hidden" asp-for="@Model.TheReservation.RestaurantId" value=@restaurantID />
                </div>
                @*First name Last name*@
                <div class="-mx-3 flex flex-wrap">
                    <div class="w-full px-3 sm:w-1/2">
                        <div class="">
                            <label asp-for="@Model.TheReservation." class="mb-3 block text-base font-medium text-[#07074D]">
                                First Name
                            </label>
                            <input type="text" name="fName" id="fName" placeholder="First Name"
                                   class="w-full rounded-md border border-[#e0e0e0] bg-white py-3 px-6 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md" />
                        </div>
                    </div>
                    <div class="w-full px-3 sm:w-1/2">
                        <div class="">
                            <label for="lName" class="mb-3 block text-base font-medium text-[#07074D]">
                                Last Name
                            </label>
                            <input type="text" name="lName" id="lName" placeholder="Last Name"
                                   class="w-full rounded-md border border-[#e0e0e0] bg-white py-3 px-6 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md" />
                        </div>
                    </div>
                </div>
            }
            else
            {
                <p class="text-center mt-6 text-xl leading-8 text-gray-700"><i>As a Registered Customer</i></p>

                <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                string customerID = Context.Request.Query["CustomerID"];
                string restaurantID = Context.Request.Query["restaurantID"];

                <input type="hidden" asp-for="@Model.TheReservation.CustomerId" value=@customerID />

                <div class="form-group">
                    <input type="hidden" asp-for="@Model.TheReservation.RestaurantId" value=@restaurantID />
                </div>

            }

            @*Guests number Special Banquets*@
            @*Guests number*@
            <div class="-mx-3 flex flex-wrap">
                <div class="w-full px-3 sm:w-1/2">
                    <div class="">
                        <label asp-for="@Model.TheReservation.NumberOfPeople"
                               class="mb-3 block text-base font-medium text-[#07074D]">
                            Number of guests
                        </label>
                        <input type="number" asp-for="@Model.TheReservation.NumberOfPeople" placeholder="5" min="0"
                               class="w-full h-16 appearance-none rounded-md border border-[#e0e0e0] bg-white py-3 px-6 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md" />
                    </div>
                </div>

                @*<div class="form-group">
                        <label asp-for="@Model.TheReservation.NumberOfPeople" class="control-label"></label>
                        <input asp-for="@Model.TheReservation.NumberOfPeople" class="form-control" />
                    </div>*@
                @*Special banquets*@
                <div class="w-full px-3 sm:w-1/2">
                    <div class="">
                        <label asp-for="@Model.TheReservation.BanquetId" class="mb-3 block text-base font-medium text-[#07074D]">
                            Special Banquets
                        </label>
                        <select asp-for="@Model.TheReservation.BanquetId" asp-items="ViewBag.Banquet" class="w-full h-16 appearance-none rounded-md border border-[#e0e0e0] bg-white py-3 px-8 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1]">
                            <option value="">Select a Banquet</option>
                        </select>
                    </div>
                </div>
            </div>

            @*<div class="form-group">
                    <label asp-for="@Model.TheReservation.BanquetId" class="control-label"></label>
                    <select asp-for="@Model.TheReservation.BanquetId" asp-items="ViewBag.Banquet" class="form-control">
                        <option value="">Select an Area</option>
                    </select>
                </div>*@

            @*Special Notes*@
            <div class="">
                <label asp-for="@Model.TheReservation.SpecialNotes" class="mb-3 block text-base font-medium text-[#07074D] justify-content-start">
                    Special Notes
                </label>
                <input type="text" asp-for="@Model.TheReservation.SpecialNotes" id="specialReq" placeholder="I am allergic to nuts"
                       class="w-full rounded-md border border-[#e0e0e0] bg-white py-3 px-6 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md" />
            </div>



            @*Area Chair Date Time*@
            <div class="-mx-3 flex flex-wrap">
                @*Area*@
                <div class="w-full px-3 sm:w-1/2">
                    <div class="">
                        <label asp-for="@Model.TheReservation.AreaId" class="mb-3 block text-base font-medium text-[#07074D] justify-content-start">Dining Area</label>
                        <select asp-for="@Model.TheReservation.AreaId" asp-items="ViewBag.AreaId" class="w-full h-16 appearance-none rounded-md border border-[#e0e0e0] bg-white py-3 px-8 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1]">
                            <option value="">Select an Area</option>
                        </select>
                    </div>
                </div>
                @*<div class="form-group">
                        <label asp-for="@Model.TheReservation.AreaId" class="mb-3 block text-base font-medium text-[#07074D] justify-content-start"></label>
                        <select asp-for="@Model.TheReservation.AreaId" asp-items="ViewBag.AreaId" class="w-full h-16 appearance-none rounded-md border border-[#e0e0e0] bg-white py-3 px-8 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1]">
                            <option value="">Select an Area</option>
                        </select>
                    </div>*@

                @*Chair*@
                <div class="w-full px-3 sm:w-1/2">
                    <div class="">
                        <label asp-for="@Model.TheReservation.HighChairs"
                               class="mb-3 block text-base font-medium text-[#07074D]">
                            Baby Seats
                        </label>
                        <input type="number" asp-for="@Model.TheReservation.HighChairs" placeholder="1" min="0"
                               class="w-full h-16 appearance-none rounded-md border border-[#e0e0e0] bg-white py-3 px-6 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md" />
                    </div>
                </div>


            </div>
            @*Date Time*@
            <div class="w-full sm:w-2/3">
                @*Date Time*@
                <div class="flex justify-left">
                    <div class="flatpickr">
                        <label asp-for="@Model.TheReservation.ReservationTiming" class="mb-3 block text-base font-medium text-[#07074D] justify-content-start">Date and Time</label>
                        <div class="flex align-middle align-content-center">
                            <input asp-for="@Model.TheReservation.ReservationTiming" type="text" id="datetime" data-input placeholder="Select date and time"
                                   class="block w-30 h-12 px-2 border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 rounded-l-md rounded-r-md shadow-sm">
                            <span asp-validation-for="@Model.TheReservation.ReservationTiming" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>
            @*<div class="form-group">
                    <label asp-for="@Model.TheReservation.ReservationTiming" class="control-label"></label>
                    <input asp-for="@Model.TheReservation.ReservationTiming" class="form-control" />
                    <span asp-validation-for="@Model.TheReservation.ReservationTiming" class="text-danger"></span>
                </div>*@

            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-outline" style="margin-top: 30px" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>



@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get the input element
        var guestInput = document.getElementById('guest');

        // Get the available seats value from the ViewBag or model property
        var availableSeats = @ViewBag.AvailableSeats; // Use the correct syntax for your view engine

        // Set the max attribute of the input element based on available seats
        guestInput.max = availableSeats;

        // Optional: Add an event listener to validate input further if needed
        guestInput.addEventListener('input', function () {
            var selectedGuests = parseInt(guestInput.value);
            if (selectedGuests > availableSeats) {
                guestInput.value = availableSeats; // Limit input to available seats
            }
        });
    });
    </script>

    <script>//const disabledDates = [
        //    new Date("2023-09-10"),
        //    new Date("2023-09-15"),
        //    new Date("2023-09-20"),
        //    // Add more dates as needed
        //];

        function getSundaysInYear(year) {
            const sundays = [];
            const startDate = new Date(year, 0, 1); // January 1st of the given year
            const endDate = new Date(year, 11, 31); // December 31st of the given year

            for (let currentDate = startDate; currentDate <= endDate; currentDate.setDate(currentDate.getDate() + 1)) {
                if (currentDate.getDay() === 0) {
                    const formattedDate = new Date(`${year}-${(currentDate.getMonth() + 1).toString().padStart(2, '0')}-${currentDate.getDate().toString().padStart(2, '0')}`);
                    sundays.push(formattedDate);
                }
            }

            return sundays;
        }
        const year = 2023;
        const disabledDates = getSundaysInYear(year);

        console.log(disabledDates);</script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.9/flatpickr.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.9/themes/airbnb.min.css">
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.js" defer></script>

    <script>// Set the maximum time for all days to 5:00 PM
        const maxTime = new Date();
        maxTime.setHours(22, 0, 0, 0); // 10PM

        const minTime = new Date();
        minTime.setHours(17, 0, 0, 0); // 10PM

        // Initialize Flatpickr with date and time options
        flatpickr("#datetime", {
            enableTime: true,
            dateFormat: 'M j, Y h:i K',
            minDate: 'today', // Set the minimum date to today
            disable: disabledDates, // Specify the array of disabled dates
            minTime: minTime, // Set the min time for all days
            maxTime: maxTime // Set the maximum time for all days
        });</script>
}
<style type="text/css">
    body {
        background-color: white;
    }


    .row {
        display: flex;
    }

    .column {
        padding: 20px;
    }

        .column:nth-child(odd) {
            background-color: #c4ccd2;
        }

        /* Adjust the width of the left column */
        .column:nth-child(1) {
            flex: 1; /* Right column will take the remaining space */
        }

        .column:nth-child(2) {
            flex: 2; /* Adjust the flex value to make it wider */
        }

    label {
        text-align: left;
        margin-bottom: 0;
        padding-bottom: 0;
        margin-top: 30px;
    }

    input {
        margin-top: 0;
        margin-bottom: 0;
        padding-bottom: 0;
    }
</style>